(function(e){function t(t){for(var n,o,l=t[0],s=t[1],c=t[2],p=0,d=[];p<l.length;p++)o=l[p],a[o]&&d.push(a[o][0]),a[o]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);u&&u(t);while(d.length)d.shift()();return i.push.apply(i,c||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,l=1;l<r.length;l++){var s=r[l];0!==a[s]&&(n=!1)}n&&(i.splice(t--,1),e=o(o.s=r[0]))}return e}var n={},a={main:0},i=[];function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=n,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/vue-ele-import/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;i.push(["e35a","chunk-vendors"]),r()})({0:function(e,t){},"0891":function(e,t,r){t=e.exports=r("2350")(!1),t.push([e.i,".ele-import-upload-tips{padding:0 20px;line-height:20px;list-style-type:decimal}.ele-import-upload-uploader{margin-top:20px;text-align:center}",""])},"0a50":function(e,t,r){var n=r("b722");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var a=r("499e").default;a("fb1dbad6",n,!0,{sourceMap:!1,shadowMode:!1})},1:function(e,t){},2:function(e,t){},2162:function(e,t,r){var n=r("cdf1");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var a=r("499e").default;a("41c10be4",n,!0,{sourceMap:!1,shadowMode:!1})},"32e92":function(e,t,r){"use strict";var n=r("8fd8"),a=r.n(n);a.a},"35a1":function(e,t,r){"use strict";var n=r("0a50"),a=r.n(n);a.a},"38f7":function(e,t,r){var n=r("a3bd");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var a=r("499e").default;a("43a9ad43",n,!0,{sourceMap:!1,shadowMode:!1})},"3a63":function(e,t,r){"use strict";var n=r("2162"),a=r.n(n);a.a},4316:function(e,t,r){"use strict";var n=r("b7dc"),a=r.n(n);a.a},"8ae8":function(e,t,r){t=e.exports=r("2350")(!1),t.push([e.i,".ele-import-download[data-v-518339ec]{text-align:center}.ele-import-download .el-icon-document[data-v-518339ec]{font-size:150px;line-height:1.2;color:#67c23a}",""])},"8fd8":function(e,t,r){var n=r("8ae8");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var a=r("499e").default;a("76a60b73",n,!0,{sourceMap:!1,shadowMode:!1})},9498:function(e,t,r){"use strict";var n=r("38f7"),a=r.n(n);a.a},a3bd:function(e,t,r){t=e.exports=r("2350")(!1),t.push([e.i,".import-error-table{margin-bottom:20px}.ele-import-error-cell{color:#fff;background:#f56c6c!important}.ele-import-error-cell:hover{background-color:#f56c6c!important;background:#f56c6c!important}",""])},b722:function(e,t,r){t=e.exports=r("2350")(!1),t.push([e.i,".ele-import-finish{text-align:center}.ele-import-finish .el-icon-success{font-size:150px;line-height:1.2;color:#67c23a}",""])},b7dc:function(e,t,r){var n=r("0891");"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var a=r("499e").default;a("295f35f1",n,!0,{sourceMap:!1,shadowMode:!1})},cdf1:function(e,t,r){t=e.exports=r("2350")(!1),t.push([e.i,".ele-import-action{margin-top:20px;text-align:center}",""])},e35a:function(e,t,r){"use strict";r.r(t);r("7f7f"),r("cadf"),r("551c"),r("f751"),r("097d");var n=r("2b0e"),a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("ele-import",{attrs:{fields:e.fields,filepath:e.filepath,formatter:e.formatter,requestFn:e.requestFn,rules:e.rules,tips:e.tips,title:e.title,visible:e.visible},on:{"update:visible":function(t){e.visible=t},close:e.handleCloseImport,finish:e.handleFinishImport}}),r("el-button",{attrs:{type:"primary"},on:{click:e.handleOpen}},[e._v("点我打开")])],1)},i=[],o=(r("96cf"),r("3b8d")),l={name:"App",data:function(){return{title:"导入人员",tips:["名字必填","年龄必填"],fields:{name:"名字",age:"年龄",city:"所在城市"},formatter:{city:{1:"深圳",2:"广州"},age:function(e,t){return e+1}},rules:{name:{type:"string",required:!0,message:"名字必填"},age:[{type:"number",message:"年龄必须为数字"},{required:!0,message:"年龄必须填写"}]},filepath:"https://dream2023.github.io/vue-ele-import/user.xlsx",visible:!1}},methods:{requestFn:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve());case 1:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}(),handleCloseImport:function(){console.log("弹窗关闭了~")},handleFinishImport:function(){console.log("导入完毕了~")},handleOpen:function(){this.visible=!0}},mounted:function(){}},s=l,c=r("2877"),u=Object(c["a"])(s,a,i,!1,null,null,null),p=u.exports,d=r("bea0"),f=r.n(d),h=(r("5b17"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e.visible?r("el-dialog",{attrs:{title:e.title,visible:e.visible,width:e.dialogWidth,"append-to-body":""},on:{close:e.handlClose}},[r("ele-steps",{attrs:{active:e.currentStep,steps:["下载模板","上传文件","确认数据","完成"],stepsAttrs:{"align-center":!0}}}),1===e.currentStep?r("ele-import-download",{attrs:{filepath:e.filepath}}):e._e(),2===e.currentStep?r("ele-import-upload",{attrs:{fields:e.fields,tips:e.tips},on:{upload:e.handleUpload}}):e._e(),3===e.currentStep?r("ele-import-data",{attrs:{fields:e.fields,formatter:e.formatter,"request-fn":e.requestFn,rules:e.rules,"table-data":e.tableData},on:{pre:e.handleStep3Pre}}):e._e(),4===e.currentStep?r("ele-import-finish",{on:{finish:e.handleFinish}}):e._e()],1):e._e()],1)}),m=[],v=r("0e4c"),b=r.n(v),g=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"ele-import-download"},[r("el-link",{attrs:{href:e.filepath,underline:!1,target:"_blank"},nativeOn:{click:function(t){return e.handleDownload(t)}}},[r("i",{staticClass:"el-icon-document"})]),r("div",[r("el-link",{attrs:{href:e.filepath,underline:!1,target:"_blank"},nativeOn:{click:function(t){return e.handleDownload(t)}}},[e._v("点击下载模板文件")])],1),r("div",{staticClass:"ele-import-action"},[r("el-button",{attrs:{type:"success"},on:{click:e.handleDownload}},[r("el-link",{staticStyle:{color:"white"},attrs:{href:e.filepath,underline:!1,target:"_blank"}},[e._v("下载模板")])],1),r("el-button",{attrs:{type:"primary"},on:{click:e.handleNext}},[e._v("下一步")])],1)],1)},y=[],w=r("8c92"),x=r.n(w),_={name:"EleImportDownload",props:{filepath:{type:String,required:!0}},inject:["goNext"],data:function(){return{hasDownload:!1}},methods:{handleDownload:function(){x.a.set("ele-import-download-"+this.filepath,!0),this.hasDownload=!0},handleNext:function(){this.hasDownload?this.goNext():this.$message.error("您还未下载模板文件")},checkHasDownload:function(){this.hasDownload=x.a.get("ele-import-download-"+this.filepath)}},mounted:function(){this.checkHasDownload()}},k=_,D=(r("32e92"),Object(c["a"])(k,g,y,!1,null,"518339ec",null)),O=D.exports,j=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e.tips&&e.tips.length?r("div",[r("el-alert",{attrs:{"show-icon":"",type:"warning"}},[r("ol",{staticClass:"ele-import-upload-tips"},e._l(e.tips,function(t,n){return r("li",{key:n},[e._v(e._s(t))])}),0)])],1):e._e(),r("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"ele-import-upload-uploader",attrs:{"before-upload":e.beforeUpload,"file-list":e.fileList,"http-request":e.fakeRequeset,limit:1,"show-file-list":!1,action:"/",drag:""}},[r("i",{staticClass:"el-icon-upload"}),r("div",{staticClass:"el-upload__text"},[e._v("\n      将填写后的文件拖到此处，或\n      "),r("em",[e._v("点击上传")])])]),r("div",{staticClass:"ele-import-action"},[r("el-button",{on:{click:e.goPre}},[e._v("上一步")]),r("el-button",{attrs:{loading:e.isLoading,type:"primary"},on:{click:e.handleGoNext}},[e._v("下一步")])],1)],1)},S=[],E=(r("2fdb"),r("ac6a"),r("8615"),r("6762"),r("28a5"),r("e429")),$=r.n(E),q=r("0619");function C(e){var t,r=[],n=$.a.utils.decode_range(e["!ref"]),a=n.s.r;for(t=n.s.c;t<=n.e.c;++t){var i=e[$.a.utils.encode_cell({c:t,r:a})],o="UNKNOWN "+t;i&&i.t&&(o=$.a.utils.format_cell(i)),r.push(o)}return r}function N(e){var t=$.a.read(e,{type:"array"}),r=t.SheetNames[0],n=t.Sheets[r],a=C(n),i=$.a.utils.sheet_to_json(n);return{columns:q(a,!0),tableData:q(i,!0)}}function F(e){return new Promise(function(t,r){var n=new FileReader;n.readAsArrayBuffer(e),n.onerror=function(e){r(e)},n.onload=function(e){var r=e.target.result,n=N(r);t(n)}})}var L=F,P={name:"EleImportUpload",props:{tips:Array,fields:{type:Object,required:!0}},inject:["goNext","goPre"],data:function(){return{fileList:[],isLoading:!1}},methods:{fakeRequeset:function(){this.fileList=[]},checkType:function(e){var t=e.name.split(".").pop().toLocaleLowerCase(),r=["xlsx","xls","csv"];return r.includes(t)},uploadError:function(e){this.$notify.error({title:"上传出错了",message:e})},checkTableTitle:function(e,t){var r=this,n=Object.values(t);n.forEach(function(t){e.includes(t)||r.$notify.error({title:"数据错处了",message:t+" 列未找到"})})},handleGoNext:function(){this.$notify.error({title:"提示",message:"请先上传数据"})},changeDatakeyAndFilter:function(e){var t=this.fields;return e.map(function(e){var r={};for(var n in t)r[n]=e[t[n]];return r})},beforeUpload:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(t){var r,n,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.isLoading){e.next=2;break}return e.abrupt("return");case 2:if(this.checkType(t)){e.next=5;break}return this.uploadError("文件："+t.name+" 文件类型错误，请在模板文件上修改后上传"),e.abrupt("return",!1);case 5:return this.isLoading=!0,e.prev=6,e.next=9,L(t);case 9:r=e.sent,n=r.columns,a=r.tableData,n.length&&a.length?(this.checkTableTitle(n,this.fields),this.$emit("upload",n,this.changeDatakeyAndFilter(a)),this.goNext()):this.uploadError("请打开模板文件, 并填写数据"),e.next=19;break;case 15:e.prev=15,e.t0=e["catch"](6),console.error(e.t0),this.uploadError("文件读取出错，请重新上传");case 19:return e.prev=19,this.isLoading=!1,e.finish(19);case 22:return e.abrupt("return",!1);case 23:case"end":return e.stop()}},e,this,[[6,15,19,22]])}));function t(t){return e.apply(this,arguments)}return t}()}},I=P,M=(r("4316"),Object(c["a"])(I,j,S,!1,null,null,null)),T=M.exports,R=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e.errorTableData.length?[r("h1",{staticStyle:{color:"#f56c6c"}},[e._v("错误信息展示")]),r("el-table",{staticClass:"import-error-table",staticStyle:{width:"100%"},attrs:{data:e.errorTableData,border:""}},[r("el-table-column",{attrs:{label:"错误行号",prop:"row",width:"180"}}),r("el-table-column",{attrs:{label:"错误原因",prop:"reason"}})],1)]:e._e(),r("h1",[e._v("数据列表")]),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticStyle:{width:"100%"},attrs:{"cell-class-name":e.checkCell,data:e.tableData,border:""}},[r("el-table-column",{attrs:{align:"center",label:"行号",type:"index",width:"50"}}),e._l(e.fields,function(t,n){return r("el-table-column",{key:n,attrs:{label:t,prop:n,align:"left","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.errorData[t.$index]&&e.errorData[t.$index][n]?r("el-tooltip",{staticClass:"item",attrs:{content:e.errorData[t.$index][n],effect:"dark",placement:"top"}},[r("div",[e._v(e._s(t.row[n]||" "))])]):[e._v(e._s(t.row[n]))]]}}],null,!0)})})],2),r("div",{staticClass:"ele-import-action"},[r("el-button",{on:{click:e.handlePre}},[e._v("重新上传")]),r("el-button",{attrs:{loading:e.isLoading,type:"primary"},on:{click:e.handleRequest}},[e._v("下一步")])],1)],2)},A=[],U=r("75fc"),K=(r("456d"),r("7514"),r("c5f6"),r("2e3d")),W={name:"EleImportData",props:{rules:{type:Object,default:function(){return{}}},fields:{type:Object,required:!0},requestFn:{type:Function,required:!0},tableData:{type:Array,default:function(){return[]}},formatter:Object},inject:["goNext","goPre"],data:function(){return{isLoading:!1,errorData:{}}},computed:{errorTableData:function(){var e=this.errorData,t=[];for(var r in e){var n=[];for(var a in e[r])n.push(e[r][a]);t.push({row:Number(r)+1,reason:n.join("、")})}return t}},methods:{checkCell:function(e){e.row;var t=e.column,r=e.rowIndex;if(this.errorData[r]&&this.errorData[r][t.property])return"ele-import-error-cell"},validateData:function(){if(this.rules){var e=new K["default"](this.rules),t=[];this.tableData.forEach(function(r,n){e.validate(r,function(e,r){e&&(t[n]=[],e.forEach(function(e){t[n][e.field]=e.message}))})}),this.errorData=t}},handlePre:function(){this.$emit("pre")},findKey:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t},n=Object.keys(e).find(function(n){return r(e[n],t)});return isNaN(Number(n))||(n=Number(n)),n},changeData:function(e){var t=this,r=this.formatter;return r&&(e=e.map(function(e){var n={};for(var a in e)r[a]&&("function"===typeof r[a]?n[a]=r[a](e[a],e):n[a]=t.findKey(r[a],e[a]));return n})),e},handleRequest:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.isLoading){e.next=2;break}return e.abrupt("return");case 2:if(!this.errorTableData.length){e.next=5;break}return this.$notify.error({title:"提示",message:"请处理完错误后重新上传"}),e.abrupt("return");case 5:return this.isLoading=!0,t=Object(U["a"])(this.tableData),t=this.changeData(t),e.prev=8,e.next=11,this.requestFn(t);case 11:this.$message.success("导入成功"),this.goNext(),e.next=19;break;case 15:e.prev=15,e.t0=e["catch"](8),this.errorData=e.t0,this.$message.error("导入失败, 请重试");case 19:return e.prev=19,this.isLoading=!1,e.finish(19);case 22:case"end":return e.stop()}},e,this,[[8,15,19,22]])}));function t(){return e.apply(this,arguments)}return t}()},mounted:function(){this.validateData()}},z=W,B=(r("9498"),Object(c["a"])(z,R,A,!1,null,null,null)),G=B.exports,H=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"ele-import-finish"},[e._m(0),r("div",[e._v("导入成功")]),r("div",{staticClass:"ele-import-action"},[r("el-button",{attrs:{type:"primary"},on:{click:e.handleFinish}},[e._v("查看详情")])],1)])},J=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("i",{staticClass:"el-icon-success"})])}],V={name:"EleImportFinish",data:function(){return{}},methods:{handleFinish:function(){this.$emit("finish")}},mounted:function(){}},Q=V,X=(r("35a1"),Object(c["a"])(Q,H,J,!1,null,null,null)),Y=X.exports,Z={name:"EleImport",props:{filepath:{type:String,required:!0},requestFn:{type:Function,required:!0},fields:{type:Object,required:!0},visible:{type:Boolean,required:!0},title:{type:String,default:"批量导入"},tips:Array,rules:Object,formatter:{type:Object,validator:function(e){for(var t in e)if(!(e[t]instanceof Object))return console.error("".concat(t,"的值必须为 对象 或 函数")),!1;return!0}},dialogWidth:{type:String,default:"80%"}},components:{EleSteps:b.a,EleImportData:G,EleImportUpload:T,EleImportFinish:Y,EleImportDownload:O},provide:function(){return{goPre:this.preStep,goNext:this.nextStep}},data:function(){return{tableData:[],columns:[],currentStep:1}},methods:{handleUpload:function(e,t){this.columns=e,this.tableData=t},initData:function(){this.tableData=[],this.columns=[],this.currentStep=1},handlClose:function(){this.initData(),this.$emit("close"),this.$emit("update:visible",!1)},handleFinish:function(){this.handlClose(),this.$emit("finish")},nextStep:function(){this.currentStep++},preStep:function(){this.currentStep--},handleStep3Pre:function(){this.tableData=[],this.columns=[],this.preStep()}},mounted:function(){}},ee=Z,te=(r("3a63"),Object(c["a"])(ee,h,m,!1,null,null,null)),re=te.exports;window&&window.Vue&&window.Vue.component(re.name,re);var ne=re;n["default"].config.productionTip=!1,n["default"].use(f.a),n["default"].component(ne.name,ne),new n["default"]({render:function(e){return e(p)}}).$mount("#app")}});
//# sourceMappingURL=main.87fe1b85.js.map